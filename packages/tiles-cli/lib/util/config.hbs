const { tiles, env, merge } = require('webpack-tiles');

module.exports = (wpEnv) => {
  env.init(wpEnv); // set webpack env before use all tiles , you can set OUTPUT_PATH and other env
  const IS_PROD = env.modeIs('prod'); // every tiles can use this function to get the env mode
  return merge(
    {
      mode: IS_PROD ? 'production' : 'development',
      devtool: IS_PROD ? false : 'inline-cheap-module-source-map', // inline-cheap-module to get fast recompile
      entry: {
        main: './src/main.js', // TODO change and add your entries
      },
    },
    // use tiles output config, and change env path(OUTPUT_PATH|PUBLIC_PATH) for tiles
    tiles.output({
      publicPath: IS_PROD ? '//cdn.imtt.qq.com/assets/' : './', // TODO set you cdn path
    }),
    {{#each tiles}}
    {{{this}}},
    {{/each}}
  );
};
